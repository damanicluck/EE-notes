\section{Practice Problems}
\begin{enumerate}
    \item Find the region of operation for the following transistors. You may use $V_{tn} = 0.9$V and $\mid V_{tp} = 1$V. The operation condition of NMOS is also shown. PMOS is conducted by holes which is opposite to NMOS so the voltage polarity is different.
    \begin{figure}[H]
        \centering
        \includegraphics[scale=0.8]{figs/ch05/pp_transistor1.png}
    \end{figure}
    \begin{center}
        \begin{tabular}{|c|c|c|}
            \hline
            Region of operation & Condsitions & \ids \\
            \hline
            Cut-off & \vgs < $V_T$ & \ids $\sim$ 0A \\
            \hline
            Linear/Triode & $V_{GS}$ > $V_T$, $V_{DS} < V_{GS} - V_T$ & \ids = {\large $\frac{W}{L} \mu_n C_{ox} (V_{GS} - V_T - \frac{V_{DS}}{2}) V_{DS}$} \\ [10pt]
            \hline
            Saturation: & $V_{GS}$ > $V_T$, $V_{DS} > V_{GS} - V_T$ & {\large \ids = $\frac{W}{L} \frac{\mu_n C_{ox}}{2} (V_{GS} - V_T)^2 (1+ \lambda V_{DS})$} \\
            \hline
        \end{tabular}
    \end{center}
    \textcolor{blue}{
    \begin{enumerate}
        \item We identify this transistor as a NMOS transistor due to the direction of the arrow. In a NMOS transistor, current flows from drain to source due to electrons being the charge carriers in the NMOS transistor. \vgs = $v_G - v_S$ = 7V and \vds = $v_D - v_S = -4 -(-8) - 4$V. This transistor is in the linear/triode region. 
        \item \vgs = 3V and \vds = 5V. This transistor is in the saturation region.
        \item This is a PMOS transistor. In a PMOS transistor, current flows from source to drain. $|v_{GS}|= 2$V and $|v_{DS}|= 0.75$V. This is in the linear/triode region.
        \item $|v_{GS}| = 4.5$V and $|v_{DS}| = |3.25 - 5| = 1.75$V. This is in the linear/triode region.
        \item $v_{GS} = 2$V and $v_{DS} = 3.25-0 = 3.25$V. This is in the saturation region.
        \item $|v_{GS}| = |4.5-5| = 0.5$V. This is in the cutoff region.
    \end{enumerate}
    }

    \item An ideal $N$-channel MOSFET has the following parameters: $W = 100$ \mun, $L = 1$ \mun, $t_{ox} = 15$ nm, the oxide relative permittivity is 4, the silicon relative permittivity is 12, $N_A = 10^{15}$\conc, $n_i = 10^{10}$\conc, $V_{FB} = -0.2$ V, $\mu_n = 300$\mobility at 300K. $\lambda = 0$.
    \begin{enumerate}
        \item Find the threshold voltage.
        \begin{Ans}
            Threshold voltage is given by the following formula:
            \begin{align*}
                \phi_B &= \frac{kT}{q} \ln\frac{N_A}{n_i} = 0.026 V \ln(\frac{10^{15} \mathrm{ cm}^{-3}}{10^{10} \mathrm{ cm}^{-3}}) = 0.2993 \dots V \\
                C_{ox} &= \frac{\epsilon_{ox}}{t_{ox}} = \frac{4(8.854 \times 10^{-14} \mathrm{F/cm})}{15 \mathrm{nm}} = 3.54 \times 10^{-7} \mathrm{F/cm}^2 \\
                V_t &= V_{FB} + 2\phi_B + \frac{\sqrt{2q\epsilon_s N_A 2 \phi_B}}{C_{ox}} \\
                &= -0.2 + 2(0.299) + \frac{2(12)(8.854 \times 10^{14} \mathrm{F/cm})(1.602 \times 10^{-19} C)(10^{15} \mathrm{cm}^{-3})(2)(0.2993 V)}{3.54 \times 10^{-7} \mathrm{F/cm}^2} \\
                &= 0.44 \mathrm{V}
            \end{align*}
        \end{Ans}

        \item What is the minumum \vds value for the MOSFET to be at saturation region at \vgs = 2V. 
        \begin{Ans}
            For the MOSFET to remain in saturation, \vds = \vgs - $V_tn$, so 
            \[V_{DS} - V_{DS} - V_{tn} = 2 - 0.44 = 1.56 \mathrm{V}\]
        \end{Ans}

        \item Find the channel resistance at \vgs = 2V and \vds = 0.01 V.
        \begin{Ans}
            Channel resistance is given by calculating what \ids is given that we know \vds is. 
            \begin{align*}
                R_{ch} &= \frac{V_{DS}}{I_{DS}} = \frac{0.01 V}{\frac{W}{L} \mu_n C_{ox} (V_{GS} - V_T) V_{DS}} \\
                &= \frac{1}{300 \times 100 \times 3.54 \times 10^{-7} \times 1.56} \\
                &= 60.36 \Omega
            \end{align*}
        \end{Ans}

        \item Find $I_D$ at \vgs = 2V and \vds = 1V.
        \begin{Ans}
            At these values, the transistor is in the linear/triode region, so 
            \begin{align*}
                I_D &= \frac{\mu_n W}{L} C_{ox} ((v_{GS} - V_{tn}) v_{DS} - \frac{v_{DS}^2}{2}) \\ 
                &= 300 \times 100 \times 3.54 \times 10^{-7}(2 - 0.44) (1 - \frac{1^2}{2}) \\
                &= 0.011 A
            \end{align*}
        \end{Ans}        

        \item Find $I_D$ at \vgs = 2V and \vds = 2V.
        \begin{Ans}
            At these values, the transistor is in the saturation region.
            \begin{align*}
                I_D &= \frac{\mu_n W}{2 L} C_{ox} (v_{gs} - v_t)^2 \\
                &= \frac{300}{2} \times 100 \times 3.54 \times 10^{-7} \times (2-0.44)^2 \\
                &= 0.013 A
            \end{align*}
        \end{Ans}
    \end{enumerate}

    \item A circuit designer intending to operate a MOSFET in saturation is considering the effect of changing the device dimensions and operating voltages on the drain current $I_D$. Specifically, by what factor does $I_D$ change in each of the following cases?
    \begin{enumerate}
        \item The channel length is doubled.
        \begin{Ans}
            The problem says that the MOSFET is in saturation. $I_D$ in saturation is 
                \[I_D = \frac{1}{2} \mu_n C_{ox} (\frac{W}{L}) (v_{GS} - V_{tn})^2\]
            From the above equation, we see that $I_D$ is inversely proportional to channel length. So, if channel length is doubled then $I_D$ will be halved.
        \end{Ans}

        \item The channel width is doubled.
        \begin{Ans}
            $I_D$ will be doubled (refer to equation for $I_D$ in saturation above).
        \end{Ans}

        \item The overdrive voltage is doubled.
        \begin{Ans}
            Overdrive voltage is equal to \vgs - $V_t$, so $I_D$ will quadruple if the overdrive voltage is doubled.
        \end{Ans}

        \item The drain to source voltage is doubled.
        \begin{Ans}
            If we doubled \vds, there will be no effect on the drain current since \vds already reaches overdrive voltage drain current saturates and remains constant.
        \end{Ans}

        \item Changes (a), (b), (c), and (d) are made simultaneously.
        \begin{Ans}
            Simultaneously doing change (a) and change (b) results in the current remaining constant. Double the overdrive voltage results in drain current quadrupling while (d) will not change drain current so the drainc current will stay 
        \end{Ans}

        \item Which of these changes might cause the MOSFET to leave the saturation region?
        \begin{Ans}
            Decreasing \vds may cause this since this may change the channel underneath.
        \end{Ans}
    \end{enumerate}

    \item An $N$-channel MOSFET with the following parameters: $W = 10$\mun, $L = 1$\mun, $V_t  =0.5$V, $\mu_n = 400$ \mobility, \cox $=4\times10^{-7}$ F/cm\sq, $\lambda = 0.01 \mathrm{V}^{-1}$.
    
    \input{figs/ch05/pp_q4.tex}

    \begin{enumerate}
        % STATIONARY WRAPFIGURE FORCED TO FLOAT: means that text paragraphs are too short to full wrap around the supplied figures
        \item Calculate \gm at \vgs = 1V and \vds = 1.2V.
        \begin{Ans}
            The formula is 
            \begin{align*}
                g_m &= \mu_n C_{ox} \frac{W}{L} (v_{GS} - V_t)(1 + \lambda V_{DS}) \\
                &=(400 \frac{cm^2}{V \cdot s})(4 \times 10^{-7} \frac{F}{cm^2})(\frac{10 \mu \mathrm{m}}{1 \mu \mathrm{m}})(1 V - 0.5V)(1+0.01 V^{-1} (1.2 V)) \\
                &= 8.096 \times 10^{-4} \Omega^{-1} \\
                &= 8.096 \times 10^{-4} S
            \end{align*}
        \end{Ans}

        \item Calculate $r_o$ at \vgs = 1V and \vds =1.2V.
        \begin{Ans}
            Formula for $r_o$ (output resistance) is 
            \begin{align*}
                r_o &= (\frac{\partial I_{DS}}{\partial v_{DS}})^{-1} \\
                &= \frac{1}{\mu_n C_{ox} \frac{W}{2L} (v_{GS} - V_t)^2  \lambda} \\
                &= \left( (\frac{400}{2} \frac{cm^2}{V \cdot s})(4 \times 10^{-7} \frac{F}{cm^2})(\frac{10 \mu \mathrm{m}}{1 \mu \mathrm{m}})(1 V - 0.5V) (0.01 V^{-1}) \right)^{-1} \\
                &= 500 k\Omega
            \end{align*}
        \end{Ans}

        \item Find the gain $\frac{v_o}{v_s}$ of this common source amplifier using this NMOS with \vgs = 1V, $R_D$ = 1 k$\Omega$ and \vdd = 1.4V. You can ignore the $\lambda$ when finding the DC bias point for simplicity. Don't need to consider capacitances and $g_{mb}$.
        \begin{Ans}
            Draw the small signal model.
            \input{figs/ch05/pp_q4_c.tex}
            We see that \vgs = $v_s$. Find $v_o$ by Ohm's Law and equivalent resistance.
            \begin{align*}
                v_o &= -g_m v_{GS} (r_o || R_D) \\
                &= -g_m v_s (r_o || R_D) \\
                \frac{v_o}{v_s} &= -g_m (r_o || R_D) \\
                &= -8.096 \times 10^{-4} \Omega^{-1} (500 k\Omega || 1 k\Omega) \\
                &= -0.808
            \end{align*}
        \end{Ans}
    \end{enumerate}

    \item For a PMOS common source amplifier:
    \input{figs/ch05/pp_q5.tex}
    \begin{enumerate}
        \item If $v_{SG} - |V_{tp}| = V_0$, and $k = \mu_p C_{ox} \frac{W}{L}$, find the maximum $R_D$ symbolically to make PMOS operation in the saturation region. Assume $\lambda = 0$. 
        \begin{Ans}
            For a PMOS transistor, it will be in saturation if $V_{SD} \geq V_{SD} - V_{tp}$
            \begin{align*}
                I_{DS} &= \frac{\mu C_{ox}}{2} \frac{W}{L} (V_{GS} - V_t)^2 \\ 
                &= \frac{k}{2} (V_{GS} - V_t)^2 \\
                &= \frac{k}{2} V_0^2 \\
                V_{SD} &= V_{DD} - R_D I_{DS} \geq V_0 \\
                V_{DD} - V_0 &\geq R_D I_{DS} \\
                V_{DD} - V_0 &\geq R_D \frac{k V_0^2}{2} \\
                R_D &\leq \frac{2 (V_{DD} - V_0)}{kV_0^2}
            \end{align*}
        \end{Ans}

        \item Draw its small-signal equivalent circuit and find out the $A_v = \frac{v_o}{v_s}$ symbolically ($R_D, g_m, r_o, g_{mb}$, and no capacitances). Please consider a finite PMOS output resistance ($r_o$) and assume it is in the saturation region. Body is grounded.
        \begin{Ans}
            \input{figs/ch05/pp_q4_c.tex}
            Notice that the small signal model for a PMOS and NMOS transistor are the same here.
            \begin{align*}
                v_o &= -gm v_s (r_o || R_D) \\
                A_v = \frac{v_o}{v_s} &= -g_m (r_o || R_D) \\
                A_v = \frac{v_o}{v_s} &= -g_m \frac{r_o R_D}{r_o + R_D}
            \end{align*}
        \end{Ans}

        \item For the same circuit in part (b) but the body is connected to $v_o$, find $A_v$.
        \begin{Ans}
            \input{figs/ch05/pp_q5_c.tex}
            The figures above show the body connected to $v_o$ and the equivalent small signal model. By superposition, we that 
                \[v_o = -(g_m V_{GS} + g_{mb} V_{BS}) r_o || R_D\]
            The following shows steps. We keep in mind there at $V_{BS} = v_o$ here $V_{GS} = v_s$ here.
            \begin{align*}
                A_v = \frac{v_o}{v_s} &= - \frac{(g_m V_{GS} + g_{mb} V_{BS})}{v_s} r_o || R_D \\
                \frac{v_o}{v_s (r_o || R_D)} &= - \frac{(g_m v_s + g_{mb} v_o)}{v_s} = - g_m  - g_{mb} \frac{v_o}{v_s} \\
                A_v (\frac{1}{r_o || R_D} + g_{mb}) &= -gm \\
                A_v &= -\frac{g_m (r_o || R_D)}{1+ g_{mb} (r_o || R_D)}
            \end{align*}
        \end{Ans}
    \end{enumerate}

    \item The figure shows the equivalent circuit of an NMOS common-gate amplifier. The NMOS transistor has $g_m = 15$ mA/V and a large $r_o$ (can be modeled as open circuit). You can ignore body effect in this problem.

    \input{figs/ch05/pp_q6.tex}
    
    \begin{enumerate}
        \item Draw the small signal AC model of the circuit using source transformation to convert $v_i$ into a current source $i_{in}$.
        \begin{Ans}
            \input{figs/ch05/pp_q6_a.tex}
        \end{Ans}

        \item Find the gain $\frac{v_o}{i_{in}}$ as a numerical answer.
        \begin{Ans}
            At the $v_s$ node, we see that 
                \[g_m V_{GS} = -g_m v_s\]
            So, we get by KCL that 
                \[i_{in} = g_m v_s + i_{10k} = g_m v_s + \frac{v_s}{10k}\]
            At the node $v_o$ also by KCL and Ohm's Law:
            \begin{align*}
                g_m V_{GS} + \frac{v_o}{5k} + \frac{v_o}{2k} &= 0 \\
                g_m v_s &= v_o (\frac{1}{5k} + \frac{1}{2k}) \\
                v_o &= \frac{g_m v_s}{5k || 2k} = 1428.56 g_m v_s \\
                \frac{v_o}{i_{in}} &= \frac{1428.56 g_m v_s}{v_s (g_m + \frac{1}{10k})} \\
                \frac{v_o}{i_{in}} &= 1419 \mathrm{V/A}
            \end{align*}
            In the second to last line we are given what $g_m$ is so we can get a numerical answer here.
        \end{Ans}

        \item What is the input resistance $Z_{in}$ as a numerical answer. Consider the source resistor in this computation.
        \begin{Ans}
            Perform 
        \end{Ans}
    \end{enumerate}
\end{enumerate}
